#!/usr/bin/env bash

projectName=
parentDir=
parentDirChoice=
languageChoice=

mkpdir() {
    mkdir "$parentDir"/"$projectName"
}

createdKittySession() {
    printf "layout tall\nnew_tab terminal\nlaunch bash\ncd %s/%s\nnew_tab yazi\ncd %s/%s\nlaunch yazi\n" "$parentDir" "$projectName" "$parentDir" "$projectName" >"$parentDir"/"$projectName"/launch.kitty-session
}

launchProject() {
    kitty --session "$parentDir"/"$projectName"/launch.kitty-session &
    emacsclient "$parentDir"/"$projectName" &
}

createProject() {
    case $languageChoice in
    rust)
        echo '{{ Color "99" " Creating a rust project "}}' | gum format -t template
        echo
        printf '{{ Color "99" " Creating project @ %s/%s "}}' "$parentDir" "$projectName" | gum format -t template
        echo

        cd "$parentDir" || exit
        cargo new "$projectName"
        createdKittySession
        ;;
    go)
        echo '{{ Color "99" " Creating a rust project "}}' | gum format -t template
        echo
        printf '{{ Color "99" " Creating project @ %s/%s "}}' "$parentDir" "$projectName" | gum format -t template
        echo

        mkpdir "$parentDir" "$projectName"
        cd "$parentDir"/"$projectName" || exit
        go mod init "$projectName"
        git init
        cat ~/nix-config/dotfiles/git/Go.gitignore >"$parentDir"/"$projectName"/.gitignore
        createdKittySession
        ;;
    zig)
        echo '{{ Color "99" " Creating a rust project "}}' | gum format -t template
        echo
        printf '{{ Color "99" " Creating project @ %s/%s "}}' "$parentDir" "$projectName" | gum format -t template
        echo

        mkpdir "$parentDir" "$projectName"
        cd "$parentDir"/"$projectName" || exit
        zig init
        git init
        cat ~/nix-config/dotfiles/git/Zig.gitignore >"$parentDir"/"$projectName"/.gitignore
        createdKittySession
        ;;
    python)
        echo '{{ Color "99" " Creating a rust project "}}' | gum format -t template
        echo
        printf '{{ Color "99" " Creating project @ %s/%s "}}' "$parentDir" "$projectName" | gum format -t template
        echo

        cd "$parentDir" || exit
        uv init "$projectName"
        createdKittySession
        ;;
    bash)
        echo '{{ Color "99" " Creating a bash project "}}' | gum format -t template
        echo
        printf '{{ Color "99" " Creating project @ %s/%s "}}' "$parentDir" "$projectName" | gum format -t template
        echo

        mkpdir "$parentDir" "$projectName"
        cd "$parentDir"/"$projectName" || exit
        git init
        touch "$projectName"
        printf "#!/usr/bin/env bash\n\n" >"$projectName"
        chmod +x "$projectName"

        createdKittySession
        ;;
    *)
        echo '{{ Color "99" " Creating a project "}}' | gum format -t template
        echo
        printf '{{ Color "99" " Creating project @ %s/%s "}}' "$parentDir" "$projectName" | gum format -t template
        echo

        mkpdir "$parentDir" "$projectName"
        cd "$parentDir"/"$projectName" || exit
        git init
        cat ~/nix-config/dotfiles/git/C.gitignore >"$parentDir"/"$projectName"/.gitignore
        createdKittySession
        ;;
    esac
}

gum style \
    --foreground 212 --border-foreground 212 --border double \
    --align center --width 50 --margin "1 2" --padding "2 4" \
    'Create a new project'

projectName=$(gum input --placeholder "Project Name")
parentDirChoice=$(gum choose github projects)

case $parentDirChoice in
github)
    parentDir=$HOME/workspaces/github/CodyBense
    ;;
*)
    parentDir=$HOME/workspaces/projects
    ;;
esac

languageChoice=$(gum choose go rust zig c python bash)

createProject "$languageChoice"

echo '{{ Color "99" " Do you want to launch the project "}}' | gum format -t template
sleep 1
gum confirm && launchProject || exit
